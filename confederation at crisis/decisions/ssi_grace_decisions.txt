###GRACE INTERACTION DECISIONS FOR MEXIKHA###

#Add the decisions in a nice order which will make sense in the menu! For example, ranked by cost/reward.


#PAYING TRIBUTE DECISIONS (GAIN GRACE)
offmap_decisions = {

	mexikhan_grace_send_gift = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 120

		potential = {
			is_offmap_tag = offmap_mexikha
		}

		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				scaled_wealth = { value = 4 min = 500 }
				custom_tooltip = {
					text = mexikhan_grace_send_gift_allow_tt 
					NOT = { has_character_modifier = mexikhan_grace_send_gift_timer }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}
		effect = {
			FROM = {
				sound_effect = china_grace_gain
				scaled_wealth = { value = -4 min = -500 } #If this changes the ai chances should probably be adjusted
				hidden_effect = {
					add_character_modifier = {
						hidden = yes
						name = mexikhan_grace_send_gift_timer
						years = 15 #Change mexikhan_grace_send_gift_allow_tt if this number changes
					} 
				}
				tooltip = {
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = wealth
							}
							NOT = {
								disliked_by_offmap = {
									type = offmap_mexikha
									context = wealth
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 450
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_tt }
							}
						}
					}
					if = {
						limit = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = wealth
							}
							NOT = {
								liked_by_offmap = {
									type = offmap_mexikha
									context = wealth
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 150
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = wealth
							}
							disliked_by_offmap = {
								type = offmap_mexikha
								context = wealth
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 300
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_but_dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							NOR = {
								liked_by_offmap = {
									type = offmap_mexikha
									context = wealth
								}
								disliked_by_offmap = {
									type = offmap_mexikha
									context = wealth
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 300
						}
					}
				}
			}
			hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.20023 } } } }
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.66 # slow down
			}
			modifier = {
				factor = 0.1
				FROM = { NOT = { monthly_income = 11 } } #I.e. it would take more than 4 years to collect the 500 gold
			}
		}
	}

	#Offering to become tributary
	mexikhan_grace_become_tributary = {
		only_independent = yes
		button_name = offmap_gifts
		ai_check_interval = 36

		potential = {
			is_offmap_tag = offmap_mexikha
		}
	
		from_potential = {
			independent = yes
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				war = no
				OR = {
					custom_tooltip = { #Borders the Mexikhan Governate
						text = mexikhan_grace_become_tributary_allow_governor_neighbor_tt
						any_neighbor_independent_ruler = {
							has_landed_title = e_mexikha
						}
					}
					custom_tooltip = { #Borders a Mexikhan tributary
						text = mexikhan_grace_become_tributary_allow_tributary_neighbor_tt
						any_neighbor_independent_ruler = {
							suzerain = {
								has_landed_title = e_mexikha
							}
						}
					}
					custom_tooltip = { #Within diplo range of Mexikha and has a port in edge of the Old World.
						text = mexikhan_grace_become_tributary_allow_iberia_tt
						any_realm_province = {
							port = yes 
							OR = {
								region = custom_beja
								region = custom_granada
								duchy  = {
									OR = {
										title = d_porto
										title = d_tangiers
										title = d_fes
										title = d_marrakech
										title = d_sous
									}
								}
							}
						}
					}
				}
				custom_tooltip = {
					text = mexikhan_grace_become_tributary_allow_suzerain_tt
					NOT = {
						is_tributary = yes
					}
				}
				NOT = { tier = emperor }
				custom_tooltip = {
					text = mexikhan_tribute_become_tributary_cooldown_tt
					NOT = { has_character_modifier = mexikhan_grace_tributary_timer }
				}
				prisoner = no
				NOT = { trait = incapable }
				NOT = { has_character_flag = asked_to_become_tributary }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}

		effect = {
			log = "---------------------"
			log = "Mexikha Logging:"
			log = "[From.GetTitledName] has voluntarily become a tributary of the [offmap_mexikha.GetFullname]"
			log = "---------------------"
			make_tributary = {
				who = FROM
				#tributary_type = offmap_mexikha
				tributary_type = offmap
			}
			hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.20027 } } } }
			custom_tooltip = { text = mexikhan_grace_become_tributary_effect_TT }
			FROM = {
				show_scope_change = no
				sound_effect = china_grace_gain
				tooltip = {
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = tributary
							}
							NOT = {
								disliked_by_offmap = {
									type = offmap_mexikha
									context = tributary
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 400
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_tt }
							}
						}
					}
					if = {
						limit = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = tributary
							}
							NOT = {
								liked_by_offmap = {
									type = offmap_mexikha
									context = tributary
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 100
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = tributary
							}
							disliked_by_offmap = {
								type = offmap_mexikha
								context = tributary
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 200
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_but_dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							NOR = {
								liked_by_offmap = {
									type = offmap_mexikha
									context = tributary
								}
								disliked_by_offmap = {
									type = offmap_mexikha
									context = tributary
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 200
						}
					}
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 0
			#modifier = {
			#	factor = 0.01 # slow down
			#}
			#modifier = { realm_levy_diff = { who = FROM value = 2000 } factor = 1.5 }
			#modifier = { realm_levy_diff = { who = FROM value = 5000 } factor = 3 }
		}
	}
	
	mexikha_supply_horses = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 36
    
		potential = {
			is_offmap_tag = offmap_mexikha
		}
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}
    
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				custom_tooltip = {
					text = mexikhan_grace_supply_horses_not_already_supplying_tt
					NOT = {
						has_character_modifier = mexikha_supply_horses
					}
				}
				custom_tooltip = {
					text = mexikhan_grace_supply_horses_stopped_supplying_tt
					NOT = {
						has_character_flag = stopped_supplying_horses
					}
				}
				war = no
				OR = {
					custom_tooltip = { #Borders the New Mexikha
						text = mexikhan_grace_become_tributary_allow_governor_neighbor_tt
						any_neighbor_independent_ruler = {
							has_landed_title = e_mexikha
						}
					}
					custom_tooltip = { #Borders a Mexikhan tributary
						text = mexikhan_grace_become_tributary_allow_tributary_neighbor_tt
						any_neighbor_independent_ruler = {
							suzerain = {
								has_landed_title = e_mexikha
							}
						}
					}
					custom_tooltip = { #Within diplo range of Mexikha and has a port in edge of the Old World.
						text = mexikhan_grace_become_tributary_allow_iberia_tt
						any_realm_province = {
							port = yes 
							OR = {
								region = custom_beja
								region = custom_granada
								duchy  = {
									OR = {
										title = d_porto
										title = d_tangiers
										title = d_fes
										title = d_marrakech
										title = d_sous
									}
								}
							}
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				capital_holding = {
					OR = {
						has_building = ca_stable_1
					}
				}
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}
    
		effect = {
			hidden_effect = { 
				offmap_mexikha = { 
					governor = { 
						character_event = { id = SSI.3040 } 
					}
					if = {
						limit = {
							FROM = { ai = no }
						}
						set_offmap_tmp_flag = mexikha_has_horse_regiments
					}
				}
			}
			FROM = {
				sound_effect = china_grace_gain
				tooltip = {
					add_character_modifier = {
						name = mexikha_supply_horses
						duration = -1
						inherit = yes
					}
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
							NOT = {
								disliked_by_offmap = {
									type = offmap_mexikha
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 150
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_tt }
							}
						}
					}
					if = {
						limit = {
							disliked_by_offmap = {
								type = offmap_mexikha
							}
							NOT = {
								liked_by_offmap = {
									type = offmap_mexikha
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 50
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 150
						}
						e_mexikha = {
							show_scope_change = no
							offmap_power = {
								show_scope_change = no
								custom_tooltip = { text = likes_but_dislikes_tt }
							}
						}
					}
					if = {
						limit = {
							NOR = {
								liked_by_offmap = {
									type = offmap_mexikha
								}
								disliked_by_offmap = {
									type = offmap_mexikha
								}
							}
						}
						add_offmap_currency = {
							offmap = offmap_mexikha
							value = 100
						}
					}
				}
			}
		}
    
		revoke_allowed = {
			always = no
		}
    
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = humble
						trait = shy
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					OR = {
						trait = ambitious
						trait = proud
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					primary_title = {
						title = e_norse_empire
					}
				}
			}
		}
	}
	
	mexikhan_grace_stop_supply_horses = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 36
    
		potential = {
			is_offmap_tag = offmap_mexikha
		}
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
			has_character_modifier = mexikha_supply_horses
		}
    
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				has_character_modifier = mexikha_supply_horses
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			#mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}
    
		effect = {
			#hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.3040 } } } }
			FROM = {
				sound_effect = china_angered_emperor
				set_character_flag = stopped_supplying_horses
				remove_character_modifier = mexikha_supply_horses
				if = {
					limit = {
						liked_by_offmap = {
							type = offmap_mexikha
						}
						NOT = {
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
					}
					add_offmap_currency = {
						offmap = offmap_mexikha
						value = -150
					}
					e_mexikha = {
						show_scope_change = no
						offmap_power = {
							show_scope_change = no
							custom_tooltip = { text = likes_tt }
						}
					}
				}
				if = {
					limit = {
						disliked_by_offmap = {
							type = offmap_mexikha
						}
						NOT = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
						}
					}
					add_offmap_currency = {
						offmap = offmap_mexikha
						value = -50
					}
					e_mexikha = {
						show_scope_change = no
						offmap_power = {
							show_scope_change = no
							custom_tooltip = { text = dislikes_tt }
						}
					}
				}
				if = {
					limit = {
						liked_by_offmap = {
							type = offmap_mexikha
						}
						disliked_by_offmap = {
							type = offmap_mexikha
						}
					}
					add_offmap_currency = {
						offmap = offmap_mexikha
						value = -150
					}
					e_mexikha = {
						show_scope_change = no
						offmap_power = {
							show_scope_change = no
							custom_tooltip = { text = likes_but_dislikes_tt }
						}
					}
				}
				if = {
					limit = {
						NOR = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
					}
					add_offmap_currency = {
						offmap = offmap_mexikha
						value = -100
					}
				}
			}
		}
    
		revoke_allowed = {
			always = no
		}
    
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					OR = {
						trait = humble
						trait = shy
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
				}
			}
		}
	}

	mexikhan_grace_offer_eunuch = {
		only_playable = yes
		button_name = offmap_gifts
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 36
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_mexikha
			OR = {
				ai = no
				mexikha_offmap_tribute_decisions_enabled_trigger = yes # Allow is checked for each valid 3rd party, so it is cheaper to check it here for the AI
			}
		}
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				custom_tooltip = {
					text = mexikha_tribute_send_eunuch_cooldown_tt
					NOT = { has_character_modifier = mexikhan_grace_send_eunuch_timer }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			tooltip = { mexikha_offmap_tribute_decisions_enabled_trigger = yes }
			hidden_tooltip = {
				OR = { 
					ai = yes
					mexikha_offmap_tribute_decisions_enabled_trigger = yes # AI has already checked this in the potential
				}
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				custom_tooltip = {
					text = adult_or_close_relative_of_12_years_tt
					OR = {
						is_adult = yes
						AND = {
							is_close_relative = ROOT_FROM
							age = 12
						}
					}
				}
				
				NOT = { is_heir = yes }

				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = { #can't be from Mexikha
					text = is_not_from_mexikha_tt
					NOT = {	has_character_flag = eunuch_gift }
					courtier_from_mexikha_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				NOT = { prisoner = yes }

				OR = {
					custom_tooltip = {
						text = is_close_relative_tt
						is_close_relative = ROOT_FROM
					}
					custom_tooltip = {
						text = mexikha_tribute_send_eunuch_stats_tt
						OR = {
							diplomacy = 20
							martial = 20
							stewardship = 20
							intrigue = 20
							learning = 20
						}
					}
					custom_tooltip = {
						text = mexikha_tribute_send_eunuch_congenital_tt
						OR = {
							trait = strong
							trait = genius
							trait = quick
							trait = fair
						}
					}
					custom_tooltip = {
						text = mexikha_tribute_send_eunuch_non_inherit_congenital_tt
						OR = {
							trait = robust
							trait = shrewd
						}
					}
					custom_tooltip = {
						text = has_the_right_eunuch_traits_tt
						OR = {
							trait = architect
							trait = administrator
							trait = strategist
							trait = scholar
							trait = faqih						
						}
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_trigger = no
			}
		}
		
		third_party_score = {
			factor = 100
			
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 8					
					hidden_trigger = {
						NOT = { diplomacy = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 12					
					hidden_trigger = {
						NOT = { diplomacy = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 16				
					hidden_trigger = {
						NOT = { diplomacy = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					martial = 8					
					hidden_trigger = {
						NOT = { martial = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					martial = 12					
					hidden_trigger = {
						NOT = { martial = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = {
					show_scope_change = no 
					martial = 16				
					hidden_trigger = {
						NOT = { martial = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					martial = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					stewardship = 8					
					hidden_trigger = {
						NOT = { stewardship = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					stewardship = 12					
					hidden_trigger = {
						NOT = { stewardship = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					stewardship = 16				
					hidden_trigger = {
						NOT = { stewardship = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					stewardship = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					intrigue = 8					
					hidden_trigger = {
						NOT = { intrigue = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					intrigue = 12					
					hidden_trigger = {
						NOT = { intrigue = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					intrigue = 16				
					hidden_trigger = {
						NOT = { intrigue = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					intrigue = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					learning = 8					
					hidden_trigger = {
						NOT = { learning = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					learning = 12					
					hidden_trigger = {
						NOT = { learning = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					learning = 16				
					hidden_trigger = {
						NOT = { learning = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					learning = 20
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = fair
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					trait = groomed
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = genius
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = { 
					show_scope_change = no
					trait = quick
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					trait = strong
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = {
					show_scope_change = no
					trait = robust
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = shrewd
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = architect
				}
			}
			additive_modifier = {
				value = 60
				FROMFROM = { 
					show_scope_change = no
					trait = administrator
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = strategist
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = scholar
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = faqih
				}
			}
			additive_modifier = {
				value = 25
				custom_tooltip = {
					text = tribute_interaction_level3_education_tt
					FROMFROM = { 
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
			}
			additive_modifier = {
				value = 50
				custom_tooltip = {
					text = tribute_interaction_level4_education_tt
					FROMFROM = { 
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
			}
			additive_modifier = {
				value = 60
				FROMFROM = {
					show_scope_change = no
					is_adult = no
				}
			}
			modifier = {
				factor = 2.0
				OR = {
					offmap_mexikha = {
						show_scope_change = no 
						offmap_has_like = likes_eunuchs
					}
				}
			}
			modifier = {
				factor = 2.0
				FROMFROM = {
					show_scope_change = no 
					liked_by_offmap = {
			            type = offmap_mexikha
			        }
				}
			}
			modifier = {
				factor = 0.5
				offmap_mexikha = {
					show_scope_change = no 
					offmap_has_dislike = likes_eunuchs
				}
			}
			modifier = {
				factor = 0.5
				FROMFROM = {
					show_scope_change = no 
					disliked_by_offmap = {
				        type = offmap_mexikha
				    }
				}
			}
			modifier = {
				factor = 1.5
				FROM = { 
					show_scope_change = no
					liked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
			modifier = {
				factor = 0.66
				FROM = {
					show_scope_change = no 
					disliked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
		}
	
		effect = {
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
			}
			FROMFROM = {
				save_event_target_as = person_sent_as_tribute
			}
			#if = {
			#	limit = {
			#		FROMFROM = { disliked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_dislike_tt }
			#}
			#if = {
			#	limit = {
			#		NOT = { FROMFROM = { disliked_by_offmap = offmap_mexikha } }
			#		FROMFROM = { liked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_like_tt }
			#}
			FROM = {
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = local_third_party_score
				}
			}
			
			# Like/Dislike effect description
			#################################
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
					NOR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_tt }
					}
				}
			}
			
			if = {
				limit = {
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
					NOR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = dislikes_tt }
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = eunuch
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_but_dislikes_tt }
					}
				}
			}
			#################################
			
			FROMFROM = {
				show_scope_change = no
				hidden_effect = {
					if = {
						limit = {
							NOT = {
								trait = eunuch
							}
						}
						add_trait = eunuch
					}
				}
				leave_court_for_mexikha_effect = yes
			}
			hidden_effect = {
				FROM = {
					add_character_modifier = {
						modifier = mexikhan_grace_send_eunuch_timer
						hidden = yes
						years = 20
					
					}
					if = {
						limit = { local_third_party_score_low_trigger = yes }
						set_character_flag = sent_bad_tribute
					}
					if = {
						limit = { local_third_party_score_medium_trigger = yes }
						set_character_flag = sent_decent_tribute
					}
					if = {
						limit = { local_third_party_score_great_trigger = yes }
						set_character_flag = sent_great_tribute
					}
					set_character_flag = sent_eunuch_tribute
					letter_event = { id = SSI.10050 days = 5 random = 2 }
				}
			}
		}
	
		revoke_allowed = {
			always = no
		}
	
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.3 # slow down
			}
		}
	}
	
	mexikhan_grace_offer_concubine = {
		only_playable = yes
		button_name = offmap_gifts
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 20
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_mexikha
			OR = {
				ai = no
				mexikha_offmap_tribute_decisions_enabled_trigger = yes # Allow is checked for each valid 3rd party, so it is cheaper to check it here for the AI
			}
		}
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
			has_concubinage = yes # test
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				custom_tooltip = {
					text = mexikha_tribute_send_concubine_cooldown_tt
					NOT = { has_character_modifier = mexikhan_grace_send_concubine_timer }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			tooltip = { mexikha_offmap_tribute_decisions_enabled_trigger = yes }
			hidden_tooltip = {
				OR = { 
					ai = yes
					mexikha_offmap_tribute_decisions_enabled_trigger = yes # AI has already checked this in the potential
				}
			}
		}
							
		third_party_potential = {
			show_only_failed_conditions = yes
			custom_tooltip = {
				text = mexikha_tribute_send_concubine_preference_tt
				OR = {
					AND = {
						offmap_mexikha = {
							offmap_ruler = {
								is_female = yes
							}
						}
						FROMFROM = {
							is_female = no
						}
					}
					AND = {
						offmap_mexikha = {
							offmap_ruler = {
								is_female = no
							}
						}
						FROMFROM = {
							is_female = yes
						}
					}
				}
			}
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = is_close_relative_or_same_dynasty_tt
					OR = {
						is_close_relative = ROOT_FROM
						dynasty = ROOT_FROM
					}
				}
				custom_tooltip = {
					text = is_adult_under_45_tt
					is_adult = yes
					NOT = { age = 45 }
				}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_mexikha_tt
					courtier_from_mexikha_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				NOT = { prisoner = yes }
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_trigger = no
			}
		}
		
		third_party_score = {
			factor = 100
			
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 8					
					hidden_trigger = {
						NOT = { diplomacy = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 12					
					hidden_trigger = {
						NOT = { diplomacy = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 16				
					hidden_trigger = {
						NOT = { diplomacy = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					diplomacy = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					martial = 8					
					hidden_trigger = {
						NOT = { martial = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					martial = 12					
					hidden_trigger = {
						NOT = { martial = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					martial = 16				
					hidden_trigger = {
						NOT = { martial = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					martial = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					stewardship = 8					
					hidden_trigger = {
						NOT = { stewardship = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					stewardship = 12					
					hidden_trigger = {
						NOT = { stewardship = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					stewardship = 16				
					hidden_trigger = {
						NOT = { stewardship = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					stewardship = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					intrigue = 8					
					hidden_trigger = {
						NOT = { intrigue = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					intrigue = 12					
					hidden_trigger = {
						NOT = { intrigue = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					intrigue = 16				
					hidden_trigger = {
						NOT = { intrigue = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					intrigue = 20
				}
			}
			additive_modifier = {
				value = 20
				FROMFROM = { 
					show_scope_change = no
					learning = 8					
					hidden_trigger = {
						NOT = { learning = 12 }
					}
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					learning = 12					
					hidden_trigger = {
						NOT = { learning = 16 }
					}
				}
			}
			additive_modifier = {
				value = 75
				FROMFROM = { 
					show_scope_change = no
					learning = 16				
					hidden_trigger = {
						NOT = { learning = 20 }
					}
				}
			}
			additive_modifier = {
				value = 120
				FROMFROM = { 
					show_scope_change = no
					learning = 20
				}
			}
			additive_modifier = {
				value = 80
				FROMFROM = { 
					show_scope_change = no
					trait = fair
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = groomed
				}
			}
			additive_modifier = {
				value = -80
				FROMFROM = { 
					show_scope_change = no
					trait = ugly
				}
			}
			additive_modifier = {
				value = -40
				FROMFROM = { 
					show_scope_change = no
					trait = uncouth
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = genius
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = { 
					show_scope_change = no
					trait = quick
				}
			}
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					trait = strong
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = robust
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = shrewd
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = charitable
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = gregarious
				}
			}
			additive_modifier = {
				value = 30
				FROMFROM = {
					show_scope_change = no
					trait = kind
				}
			}
			additive_modifier = {
				value = -50
				FROMFROM = {
					show_scope_change = no
					trait = lunatic
				}
			}
			additive_modifier = {
				value = 25
				custom_tooltip = {
					text = tribute_interaction_level3_education_tt
					FROMFROM = { 
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
			}
			additive_modifier = {
				value = 50
				custom_tooltip = {
					text = tribute_interaction_level4_education_tt
					FROMFROM = { 
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
			}
			modifier = {
				factor = 2.0
				OR = {
					offmap_mexikha = {
						show_scope_change = no 
						offmap_has_like = likes_concubines
					}
				}
			}
			modifier = {
				factor = 2.0
				FROMFROM = {
					show_scope_change = no 
					liked_by_offmap = {
			            type = offmap_mexikha
			        }
				}
			}
			modifier = {
				factor = 0.5
				offmap_mexikha = {
					show_scope_change = no 
					offmap_has_dislike = likes_concubines
				}
			}
			modifier = {
				factor = 0.5
				FROMFROM = {
					show_scope_change = no 
					disliked_by_offmap = {
				        type = offmap_mexikha
				    }
				}
			}
			modifier = {
				factor = 1.5
				FROM = { 
					show_scope_change = no
					liked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
			modifier = {
				factor = 0.66
				FROM = {
					show_scope_change = no 
					disliked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
		}
	
		effect = {
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
			}
			FROMFROM = {
				save_event_target_as = person_sent_as_tribute
			}
			#if = {
			#	limit = {
			#		FROMFROM = { disliked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_dislike_tt }
			#}
			#if = {
			#	limit = {
			#		NOT = { FROMFROM = { disliked_by_offmap = offmap_mexikha } }
			#		FROMFROM = { liked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_like_tt }
			#}
			
			FROM = {
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = local_third_party_score
				}
			}
			
			# Like/Dislike effect description
			#################################
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
					NOR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_tt }
					}
				}
			}
			
			if = {
				limit = {
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
					NOR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = dislikes_tt }
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							liked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
						FROMFROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
								context = concubine
							}
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_but_dislikes_tt }
					}
				}
			}
			#################################
			
			
			FROMFROM = {
				show_scope_change = no
				leave_court_for_mexikha_effect = yes
			}
			hidden_effect = {
				FROM = {
					add_character_modifier = {
						modifier = mexikhan_grace_send_concubine_timer
						hidden = yes
						years = 20
					
					}
					if = {
						limit = { local_third_party_score_low_trigger = yes }
						set_character_flag = sent_bad_tribute
					}
					if = {
						limit = { local_third_party_score_medium_trigger = yes }
						set_character_flag = sent_decent_tribute
					}
					if = {
						limit = { local_third_party_score_great_trigger = yes }
						set_character_flag = sent_great_tribute
					}
					set_character_flag = sent_concubine_tribute
					letter_event = { id = SSI.10050 days = 5 random = 2 }
				}
			}
		}
	
		revoke_allowed = {
			always = no
		}
	
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5 # slow down
			}
		}
	}
	
	mexikhan_grace_offer_physician = {
		only_playable = yes
		button_name = offmap_gifts
		
		third_party_filter = all
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 36
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_mexikha
			offmap_mexikha = { has_status = mexikha_plague }
		}
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				custom_tooltip = {
					text = mexikha_tribute_send_physician_tt
					NOT = { has_character_flag = mexikhan_grace_physician_sent }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					liege = {
						character = ROOT_FROM
					}
				}
				show_scope_change = no
				NOT = { is_ruler = yes }
				is_adult = yes
				is_heir = no
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_mexikha_tt
					courtier_from_mexikha_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				OR = {
					conditional_tooltip = {
						trigger = {
							has_dlc = Reapers
						}
						has_minor_title = title_court_physician 
					}
					trait = physician
					trait = scholar
					trait = mystic
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
			}
		}
		
		third_party_score = {
			factor = 100
			
			additive_modifier = {
				value = -50
				FROMFROM = { 
					show_scope_change = no
					NOT = { learning = 8 }
				}
			}
			
			additive_modifier = {
				value = 40
				FROMFROM = { 
					show_scope_change = no
					learning = 8					
					hidden_trigger = {
						NOT = { learning = 12 }
					}
				}
			}
			additive_modifier = {
				value = 60
				FROMFROM = { 
					show_scope_change = no
					learning = 12					
					hidden_trigger = {
						NOT = { learning = 16 }
					}
				}
			}
			additive_modifier = {
				value = 100
				FROMFROM = { 
					show_scope_change = no
					learning = 16				
					hidden_trigger = {
						NOT = { learning = 20 }
					}
				}
			}
			additive_modifier = {
				value = 140
				FROMFROM = { 
					show_scope_change = no
					learning = 20				
					hidden_trigger = {
						NOT = { learning = 24 }
					}
				}
			}
			additive_modifier = {
				value = 180
				FROMFROM = { 
					show_scope_change = no
					learning = 24				
					hidden_trigger = {
						NOT = { learning = 28 }
					}
				}
			}
			additive_modifier = {
				value = 220
				FROMFROM = { 
					show_scope_change = no
					learning = 28				
					hidden_trigger = {
						NOT = { learning = 32 }
					}
				}
			}
			additive_modifier = {
				value = 260
				FROMFROM = { 
					show_scope_change = no
					learning = 32
				}
			}
			additive_modifier = {
				value = 100
				FROMFROM = { 
					show_scope_change = no
					trait = genius
				}
			}
			additive_modifier = {
				value = 50
				FROMFROM = { 
					show_scope_change = no
					trait = quick
				}
			}
			additive_modifier = {
				value = 50
				FROMFROM = {
					show_scope_change = no
					trait = shrewd
				}
			}
			additive_modifier = {
				value = 150
				FROMFROM = { 
					show_scope_change = no
					trait = physician
				}
			}
			additive_modifier = {
				value = 50
				FROMFROM = { 
					show_scope_change = no
					trait = mystic
				}
			}
			additive_modifier = {
				value = 50
				FROMFROM = { 
					show_scope_change = no
					trait = scholar
				}
			}
			additive_modifier = {
				value = 25
				trait = scholarly_theologian
			}
			additive_modifier = {
				value = 50
				trait = mastermind_theologian
			}
			additive_modifier = {
				value = 25
				trait = patient
			}
			additive_modifier = {
				value = 25
				trait = diligent
			}
			modifier = {
				factor = 1.5
				FROM = { 
					show_scope_change = no
					liked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
			modifier = {
				factor = 0.66
				FROM = {
					show_scope_change = no 
					disliked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
		}
	
		effect = {
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
			}
			FROMFROM = {
				save_event_target_as = person_sent_as_tribute
			}
			#if = {
			#	limit = {
			#		FROMFROM = { disliked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_dislike_tt }
			#}
			#if = {
			#	limit = {
			#		NOT = { FROMFROM = { disliked_by_offmap = offmap_mexikha } }
			#		FROMFROM = { liked_by_offmap = offmap_mexikha }
			#	}
			#	custom_tooltip = { text = notification_mexikha_like_tt }
			#}
			FROM = {
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = local_third_party_score
				}
			}
			
			FROMFROM = {
				show_scope_change = no
				leave_court_for_mexikha_effect = yes
			}
			hidden_effect = {
				FROM = {
					set_character_flag = mexikhan_grace_physician_sent
					if = {
						limit = { local_third_party_score_low_trigger = yes }
						set_character_flag = sent_bad_tribute
					}
					if = {
						limit = { local_third_party_score_medium_trigger = yes }
						set_character_flag = sent_decent_tribute
					}
					if = {
						limit = { local_third_party_score_great_trigger = yes }
						set_character_flag = sent_great_tribute
					}
					letter_event = { id = SSI.10050 days = 5 random = 2 }
				}
			}
		}
	
		revoke_allowed = {
			always = no
		}
	
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.3 # slow down
			}
		}
	}
	
	mexikhan_grace_offer_artifact = {
		only_playable = yes
		button_name = offmap_gifts
		
		third_party_filter = artifacts
		ai_third_party_filter = artifacts
		third_party = FROM
		ai_check_interval = 60
		show_third_party_potential = yes
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		potential = {
			is_offmap_tag = offmap_mexikha
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			# mexikha_offmap_decisions_enabled_trigger = yes #leave in please, to be used if the tooltip for mexikha_offmap_tribute_decisions_enabled_trigger changes and we need to reference things uniquely again
			mexikha_offmap_tribute_decisions_enabled_trigger = yes
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = mexikha_send_artifact_potential_tt
					quality > 2
					NOR = {
						has_artifact_flag = flag_considering_donation 
						has_artifact_flag = curse
						has_artifact_flag = mexikhan
						AND = {
							FROM = { NOT = { has_landed_title = e_hre } }
							artifact_type = crown_hre
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_byzantium } }
							artifact_type = crown_byzantine
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_norse_pagan_reformed } }
							artifact_type = crown_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
							artifact_type = crown_tengri_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
							artifact_type = crown_slavic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
							artifact_type = crown_romuva_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
							artifact_type = crown_finnish_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
							artifact_type = crown_west_african_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_zun_pagan_reformed } }
							artifact_type = crown_zun_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = k_hellenic_pagan } }
							artifact_type = scepter_hellenic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_bon_reformed } }
							artifact_type = scepter_bon_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_aztec_reformed } }
							artifact_type = crown_aztec_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_persia } }
							artifact_type = crown_pahlavi
						}
					}
				}
			}
		}
		
		third_party_allow = {
			
		}
		
		third_party_score = {
			factor = 500
			
			additive_modifier = {
				value = 4500
				FROMFROM = { 
					quality == 4
				}
			}
			additive_modifier = {
				value = 9500
				FROMFROM = { 
					quality == 5
				}
			}
			additive_modifier = {
				value = -200
				FROMFROM = {
					quality < 4
					has_artifact_flag = lore #Magnum Opus book
				}
			}
			additive_modifier = {
				value = -3000
				FROMFROM = {
					quality == 4
					has_artifact_flag = lore #Magnum Opus book
				}
			}
			additive_modifier = {
				value = -250
				FROMFROM = {
					quality < 4
					has_artifact_flag = created
				}
			}
			additive_modifier = {
				value = -3500
				FROMFROM = {
					quality == 4
					has_artifact_flag = created
				}
			}
			modifier = {
				factor = 1.5
				offmap_mexikha = {
					show_scope_change = no 
					offmap_has_like = likes_wealth
				}
			}
			modifier = {
				factor = 0.5
				offmap_mexikha = {
					show_scope_change = no 
					offmap_has_dislike = likes_wealth
				}
			}
			modifier = {
				factor = 1.5
				FROM = { 
					show_scope_change = no
					liked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					show_scope_change = no 
					disliked_by_offmap = {
						type = offmap_mexikha
					}
				}
			}
		}
	
		effect = {
			FROM = {
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = local_third_party_score
				}
			}

			# Like/Dislike effect description
			#################################
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_like = likes_wealth
						}
					}
					NOR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_dislike = likes_wealth
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_tt }
					}
				}
			}
			
			if = {
				limit = {
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_dislike = likes_wealth
						}
					}
					NOR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_like = likes_wealth
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = dislikes_tt }
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = {
							liked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_like = likes_wealth
						}
					}
					OR = {
						FROM = {
							disliked_by_offmap = {
								type = offmap_mexikha
							}
						}
						offmap_mexikha = {
							offmap_has_dislike = likes_wealth
						}
					}
				}
				e_mexikha = {
					show_scope_change = no
					offmap_power = {
						show_scope_change = no
						custom_tooltip = { text = likes_but_dislikes_tt }
					}
				}
			}
			#################################
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
			}

			hidden_effect = { #to reduce cluttered tooltip (effect already heavily implied...)
				offmap_mexikha = {
					offmap_ruler = {
						ROOT_FROMFROM = {
							show_scope_change = no
							tooltip = {
								transfer_artifact = {
									to = PREV
									from = ROOT_FROM
								}
							}
							hidden_effect = { unsafe_destroy_artifact = yes }
						}
					}
				}
			}

			hidden_effect = {
				FROM = {
					set_character_flag = ssi_gifting_artifact
				}
				hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.20023 } } } }
			}
		}
	
		revoke_allowed = {
			always = no
		}
	
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROMFROM = {
					quality > 3
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
		}
	}
}



#REQUESTING BOON DECISIONS (PENDING GRACE)
offmap_decisions = {
	
	#If your grace decisions will spawn a character then give them an appropriate flag eg: is_mexikhan_administrator and add them to the SSI.60310 trigger switch to refund grace if they die early
	
	#Get a Mexikhan doctor
	mexikhan_grace_doctor = {
		only_playable = yes
		button_name = offmap_boons
		ai_check_interval = 12

		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			has_dlc = Reapers
			mercenary = no
			holy_order = no
			is_landed = yes

		}

		potential = {
			is_offmap_tag = offmap_mexikha
		}

		#potential = {
			#offmap_mexikha = { governor = { character = ROOT } }
		#}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				has_offmap_currency = { offmap = offmap_mexikha value = 250 }
				custom_tooltip = {
					text = mexikhan_grace_doctor_allow_tt
					NOT = { any_courtier_or_vassal = { has_minor_title = title_court_physician } }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			mexikha_offmap_boon_decisions_enabled_trigger = yes
		}

		effect = {
			FROM = {
				show_scope_change = no
				sound_effect = mexikha_china_spend
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = -250
				}
			}
			hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.20021 } } } }
			hidden_effect = { FROM = { set_mexikha_boon_cd_effect = yes } }
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 0
			#factor = 1
			#modifier = {
			#	factor = 0.1 # slow down
			#}
			#modifier = {
			#	FROM = { NOT = { any_courtier = { learning = 15 } } }
			#	factor = 1.5
			#}
			#modifier = {
			#	FROM = {
			#		NOT = { any_courtier = { learning = 15 } }
			#		OR = {
			#			NOT = { health = 3 }
			#			character_disease_trigger = yes
			#			has_symptom_trigger = yes
			#		}
			#	}
			#	factor = 10
			#}
			#modifier = {
			#	FROM = {
			#		NOT = { has_grace_medium_trigger = yes }
			#	}
			#	factor = 0.1
			#}
		}
	}
	
	# Mexikhan Artifact
	mexikhan_artifact = {
		only_playable = yes
		button_name = offmap_boons
		ai_check_interval = 60

		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		potential = {
			is_offmap_tag = offmap_mexikha
		}
	
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				has_offmap_currency = { offmap = offmap_mexikha value = 500 }
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			mexikha_offmap_boon_decisions_enabled_trigger = yes
			custom_tooltip = {
				text = mexikhan_artifact_has_all_tt
				hidden_tooltip = {
					FROM = {
						NAND = {
							has_artifact = jaguar_cloak
							has_artifact = aztec_macuahuitl
							has_artifact = aztec_sling
						}
					}
				}
			}
		}

		effect = {
			FROM = {
				show_scope_change = no
				
				sound_effect = mexikha_china_spend

				add_offmap_currency = {
					offmap = offmap_mexikha
					value = -500
				}
				custom_tooltip = { text = mexikhan_artifact_effect_tt }
			}
			hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.3030 } } } }
			hidden_effect = { FROM = { set_mexikha_boon_cd_effect = yes } }
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = greedy
				}
			}
		}
	}

	# mexikhan_master_mason > mexikhan_master_mason
	mexikhan_master_mason = {
		only_playable = yes
		button_name = offmap_boons
		ai_check_interval = 60

		from_potential = {
			always = no # WIP
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		potential = {
			is_offmap_tag = offmap_mexikha
		}
	
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				higher_tier_than = COUNT
				has_offmap_currency = { offmap = offmap_mexikha value = 1000 }
				custom_tooltip = {
					text = mexikhan_master_mason_allow_tt
					NOT = { any_courtier = { has_minor_title = title_master_mason } }
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			mexikha_offmap_boon_decisions_enabled_trigger = yes
		}

		effect = {
			FROM = {
				show_scope_change = no
				sound_effect = mexikha_china_spend
				add_offmap_currency = {
					offmap = offmap_mexikha
					value = -1000
				}
				custom_tooltip = { text = mexikhan_master_mason_effect_tt }
			}
			hidden_effect = { offmap_mexikha = { governor = { character_event = { id = SSI.20031 } } } }
			hidden_effect = { FROM = { set_mexikha_boon_cd_effect = yes } }
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				FROM = {
					NOT = { has_grace_major_trigger = yes }
				}
				factor = 0.1
			}
			modifier = {
				factor = 0
				FROM = {	
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
				}
			}
		}
	}
}

#HOSTILE DECISIONS (ATTACKING MEXIKHA)
offmap_decisions = {

	mexikha_tributary_break_free = {
		only_playable = yes
		button_name = offmap_hostility2
		ai = no
	
		from_potential = {
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
			is_landed = yes
		}

		potential = {
			is_offmap_tag = offmap_mexikha
			FROM = {
				is_tributary = {
					type = offmap
					suzerain = ROOT
				}
			}
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = yes
				is_tributary = {
					type = offmap
					suzerain = ROOT
				}
				NOT = { is_decision_allowed = tributary_independence_mexikha }
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			mexikha_offmap_hostile_decisions_enabled_trigger = yes
		}

		effect = {
			FROM = {
				show_scope_change = no
				sound_effect = china_angered_emperor
				war = {
					target = ROOT
					casus_belli = free_tributary_cb
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 0
		}
	}

	mexikha_invade_skull_throne = { # mod it as torch operation when e_mexikha holds no lands on map
		only_playable = yes
		button_name = offmap_hostility2
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		show_third_party_potential = yes
		ai = no
	
		from_potential = {
			always = no # WIP
			#has_dlc = "Sunset Invasion"
			#has_global_flag = aztec_explorers
			mercenary = no
			holy_order = no
		}

		potential = {
			is_offmap_tag = offmap_mexikha
			has_offmap_flag = aztecs_landed
			#NOT = { offmap_ruler = { dynasty = FROM } }
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				independent = yes
				in_revolt = no
				NOT = {
					is_tributary = {
						type = offmap
						suzerain = ROOT
					}
				}
				#OR = {
				#	custom_tooltip = { #Borders the New Mexikha
				#		text = mexikhan_grace_become_tributary_allow_governor_neighbor_tt
				#		any_neighbor_independent_ruler = {
				#			has_landed_title = e_mexikha
				#		}
				#	}
				#}
				custom_tooltip = {
					text = mexikha_invade_skull_throne_failed_tt
					NOT = { has_character_modifier = failed_invasion_of_mexikha }
				}
				can_use_cb = {
					target = ROOT
					casus_belli = invasion_of_mexikha_cb
					only_check_triggers = yes
				}
				NOT = { has_raised_levies = THIS }
				custom_tooltip = {
					text = mexikha_invade_skull_throne_levies_tt
					NOT = { any_vassal = { ROOT_FROM = { has_raised_levies = PREV } } }
				}
				NOT = { has_truce = ROOT }
				tier = EMPEROR
				conditional_tooltip = {
					trigger = { is_nomadic = no }
					realm_size = 200
				}
				conditional_tooltip = {
					trigger = { is_nomadic = yes }
					num_of_count_titles_in_realm = 50
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			mexikha_offmap_hostile_decisions_enabled_trigger = yes
			offmap_mexikha = {
				#OR = {
				#	has_status = mexikha_stable
				#	has_status = mexikha_golden_age
				#}
				ROOT = {
					show_scope_change = no
					custom_tooltip = {
						text = mexikha_invade_skull_throne_war_tt
						NOT = { any_war = { using_cb = invasion_of_mexikha_cb } }
					}
				}
			}
		}

		effect = {
			hidden_effect = {
				ROOT = { #Set amount of troops
					set_offmap_tmp_flag = mexikha_war_variables_set
					set_variable = {
						which = mexikha_war_troop_quantity
						value = 15
						# 15 regiments of ~500 units
					}
					set_variable = {
						which = mexikha_war_target_match_mult
						value = 2
					}
					set_variable = {
						which = mexikha_war_troop_quality
						value = 6
						# Value between 1-7
					}
					set_variable = {
						which = mexikha_war_minimum_commander_martial
						value = 16
					}
					set_variable = { #Minimum 80k
						which = mexikha_war_troop_quantity_override
						value = 160
					}
					save_event_target_as = invasion_of_mexikha_govenor
				}
			}
			FROM = {
				show_scope_change = no
				sound_effect = china_angered_emperor
				save_event_target_as = invasion_of_mexikha_attacker
				custom_tooltip = {
					text = mexikha_invade_skull_throne_modifiers_tt
					hidden_effect = {
						set_offmap_currency = { offmap = offmap_mexikha value = 0 }
						remove_character_modifier = peace_deal_with_mexikha
						remove_character_modifier = mexikhan_grace_send_gift_timer
						remove_character_modifier = mexikhan_grace_send_eunuch_timer
						remove_character_modifier = mexikhan_grace_send_concubine_timer
						remove_character_modifier = mexikhan_grace_tributary_timer
						remove_character_modifier = ssi_mexikha_boon_cd
						remove_character_modifier = mexikha_force_open_cooldown
						remove_character_modifier = angered_mexikha_modifier
						remove_character_modifier = mexikhan_imperial_trade_contract
					}
				}
				hidden_effect = {
					add_character_modifier = {
						name = war_with_mexikha_modifier
						inherit = yes
						duration = -1
					}
					war = {
						target = ROOT
						casus_belli = invasion_of_mexikha_cb
					}
				}
			}
			hidden_effect = {
				any_player = {
					limit = {
						has_offmap_news_enabled = offmap_mexikha
						is_within_diplo_range = ROOT
					}
					narrative_event = { id = SSI.60400 }
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 0
		}
	}
}